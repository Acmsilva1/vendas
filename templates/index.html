<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Vendas DiÃ¡ria | Dashboard</title>
    <style>
        /* --- [7] UI CONSTANTS --- */
        :root { --bg: #0a0a0a; --card: #111; --border: #333; --accent: #3498db; --green: #2ecc71; --red: #e74c3c; --yellow: #f1c40f; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #eee; margin: 0; padding: 20px; }
        .grid-main { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .card { background: var(--card); border-top: 4px solid var(--accent); padding: 15px; border-radius: 4px; }
        .valor { font-size: 1.6rem; font-weight: bold; margin-top: 8px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid var(--border); }
        .alerta-txt { font-size: 0.7rem; font-weight: bold; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="grid-main">
        <div class="card">
            <h3>Vendas Hoje</h3>
            <div class="valor" id="v_hoje">R$ 0,00</div>
        </div>
        <div class="card" id="card-eficiencia">
            <h3>EficiÃªncia (Gastos %)</h3>
            <div class="valor" id="p_gasto">0%</div>
            <div id="status_alerta" class="alerta-txt">PROCESSANDO...</div>
        </div>
    </div>

    <div class="grid-main" style="grid-template-columns: 1fr 1fr;">
        <div class="card" style="border-top-color: var(--red);">
            <h3>ðŸ›’ TOP COMPRAS (INSUMOS)</h3>
            <table id="tab-compras">
                <thead><tr><th>Item</th><th>Qtd</th><th>Total</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card" style="border-top-color: var(--yellow);">
            <h3>ðŸ•’ ÃšLTIMAS VENDAS</h3>
            <table id="tab-ultimas">
                <thead><tr><th>Sabor</th><th>Valor</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
        /* --- [8] JS: UPDATE (ALTERADA: LÃ“GICA DE ALERTA E NOVAS TABELAS) --- */
        const fmt = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v || 0);
        
        async function update() {
            try {
                const res = await fetch('/api/status');
                const d = await res.json();
                
                // KPIs BÃ¡sicos
                document.getElementById('v_hoje').innerText = fmt(d.vendas_hoje);
                document.getElementById('p_gasto').innerText = d.percentual_gastos + '%';

                // LÃ³gica de SemÃ¡foro
                const p = d.percentual_gastos;
                const card = document.getElementById('card-eficiencia');
                const txt = document.getElementById('status_alerta');
                
                if(p > 50) { card.style.borderTopColor = 'var(--red)'; txt.innerText = "CRÃTICO"; txt.style.color = 'var(--red)'; }
                else if(p > 30) { card.style.borderTopColor = 'var(--yellow)'; txt.innerText = "ATENÃ‡ÃƒO"; txt.style.color = 'var(--yellow)'; }
                else { card.style.borderTopColor = 'var(--green)'; txt.innerText = "SAUDÃVEL"; txt.style.color = 'var(--green)'; }

                // Tabelas
                document.querySelector('#tab-compras tbody').innerHTML = d.ranking_compras.map(c => 
                    `<tr><td>${c.ITEM}</td><td>${c.qtd}</td><td>${fmt(c.total)}</td></tr>`).join('');
                
                document.querySelector('#tab-ultimas tbody').innerHTML = d.ultimas_vendas.map(v => 
                    `<tr><td>${v.SABORES}</td><td>${fmt(v['VALOR DA VENDA'])}</td></tr>`).join('');

            } catch (e) { console.error("Erro na Matrix"); }
        }
        setInterval(update, 300000);
        update();
    </script>
</body>
</html>
